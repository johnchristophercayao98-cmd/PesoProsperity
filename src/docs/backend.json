{
  "entities": {
    "FinancialGoal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FinancialGoal",
      "type": "object",
      "description": "Represents a user's financial goal, such as saving for a down payment or paying off debt.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the financial goal."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N FinancialGoal)"
        },
        "name": {
          "type": "string",
          "description": "Name of the financial goal (e.g., 'Down Payment', 'Debt Freedom')."
        },
        "targetAmount": {
          "type": "number",
          "description": "The target amount to be achieved for the goal."
        },
        "currentAmount": {
          "type": "number",
          "description": "The current amount saved or reduced towards the goal."
        },
        "targetDate": {
          "type": "string",
          "description": "The target date to achieve the financial goal.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the financial goal."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "targetAmount",
        "currentAmount",
        "targetDate"
      ]
    },
    "RecurringTransaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "RecurringTransaction",
      "type": "object",
      "description": "Represents a recurring income or expense transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the recurring transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N RecurringTransaction)"
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction (e.g., 'Salary', 'Rent')."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "category": {
          "type": "string",
          "description": "Category of the transaction (e.g., 'Income', 'Expense')."
        },
        "subcategory": {
          "type": "string",
          "description": "Sub-category of the transaction (e.g., 'Sales', 'Rent')."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the transaction (e.g., 'Cash', 'Bank Transfer')."
        },
        "frequency": {
          "type": "string",
          "description": "Frequency of the transaction (e.g., 'Daily', 'Weekly', 'Monthly', 'Yearly')."
        },
        "startDate": {
          "type": "string",
          "description": "Start date for the recurrence.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date for the recurrence.",
          "format": "date-time"
        },
        "autoApprove": {
          "type": "boolean",
          "description": "Indicates whether the transaction is automatically approved or requires manual approval."
        }
      },
      "required": [
        "id",
        "userId",
        "description",
        "amount",
        "category",
        "subcategory",
        "paymentMethod",
        "frequency",
        "startDate"
      ]
    },
    "Budget": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Budget",
      "type": "object",
      "description": "Represents a user's budget for a specific period.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the budget."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Budget)"
        },
        "name": {
          "type": "string",
          "description": "Name of the budget (e.g., 'Monthly Budget', 'Q1 2024 Budget')."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the budget period.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the budget period.",
          "format": "date-time"
        },
        "income": {
          "type": "array",
          "description": "Income categories for the budget.",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "budgeted": { "type": "number" },
              "actual": { "type": "number" }
            },
            "required": ["name", "budgeted", "actual"]
          }
        },
        "expenses": {
          "type": "array",
          "description": "Expense categories for the budget.",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "budgeted": { "type": "number" },
              "actual": { "type": "number" }
            },
            "required": ["name", "budgeted", "actual"]
          }
        },
        "liabilities": {
          "type": "array",
          "description": "Liability categories for the budget.",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "budgeted": { "type": "number" },
              "actual": { "type": "number" }
            },
            "required": ["name", "budgeted", "actual"]
          }
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "startDate",
        "endDate"
      ]
    },
    "Expense": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Expense",
      "type": "object",
      "description": "Represents an expense incurred by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the expense."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Expense)"
        },
        "date": {
          "type": "string",
          "description": "Date the expense was incurred.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "Description of the expense."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the expense."
        },
        "category": {
          "type": "string",
          "description": "Category of the expense."
        },
        "paymentMethod": {
          "type": "string",
          "description": "Payment method used for the expense."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "description",
        "amount",
        "category",
        "paymentMethod"
      ]
    },
    "Debt": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Debt",
      "type": "object",
      "description": "Represents a debt owed by the user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the debt."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Debt)"
        },
        "name": {
          "type": "string",
          "description": "Name of the debt (e.g., 'Credit Card', 'Loan')."
        },
        "principalAmount": {
          "type": "number",
          "description": "Original principal amount of the debt."
        },
        "interestRate": {
          "type": "number",
          "description": "Interest rate for the debt."
        },
        "minimumPayment": {
          "type": "number",
          "description": "Minimum payment amount for the debt."
        },
        "currentBalance": {
          "type": "number",
          "description": "Current outstanding balance of the debt."
        },
        "term": {
          "type": "number",
          "description": "The loan term in months."
        }
      },
      "required": [
        "id",
        "userId",
        "name",
        "principalAmount",
        "interestRate",
        "minimumPayment",
        "currentBalance"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter is the unique identifier for each user.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/financialGoals/{financialGoalId}",
        "definition": {
          "entityName": "FinancialGoal",
          "schema": {
            "$ref": "#/backend/entities/FinancialGoal"
          },
          "description": "Stores financial goals for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "financialGoalId",
              "description": "Unique identifier for the financial goal."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/recurringTransactions/{recurringTransactionId}",
        "definition": {
          "entityName": "RecurringTransaction",
          "schema": {
            "$ref": "#/backend/entities/RecurringTransaction"
          },
          "description": "Stores recurring transactions for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "recurringTransactionId",
              "description": "Unique identifier for the recurring transaction."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/budgets/{budgetId}",
        "definition": {
          "entityName": "Budget",
          "schema": {
            "$ref": "#/backend/entities/Budget"
          },
          "description": "Stores budgets for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "budgetId",
              "description": "Unique identifier for the budget."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/expenses/{expenseId}",
        "definition": {
          "entityName": "Expense",
          "schema": {
            "$ref": "#/backend/entities/Expense"
          },
          "description": "Stores expenses for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "expenseId",
              "description": "Unique identifier for the expense."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/debts/{debtId}",
        "definition": {
          "entityName": "Debt",
          "schema": {
            "$ref": "#/backend/entities/Debt"
          },
          "description": "Stores debt information for each user. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user."
            },
            {
              "name": "debtId",
              "description": "Unique identifier for the debt."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure data persistence, eliminate hierarchical authorization dependencies, and support the core features of the PesoProsperity application, specifically financial planning, cost control, and cash flow management. The structure leverages path-based ownership for user-specific data and avoids `get()` calls in security rules by denormalizing authorization data. This approach guarantees Authorization Independence (CRITICAL) and ensures that rules are not filters (QAPs). Adding or deleting data will persist across reloads and app restarts, as Firestore is a persistent database. All document IDs will be generated client-side to avoid collisions and ensure immediate availability after creation. Each collection is designed with a homogeneous security posture, simplifying security rule definitions.\n\n1.  **User-Owned Data:** Financial goals, budgets, recurring transactions, expenses, and debts are stored as subcollections under the `/users/{userId}` path. This establishes clear ownership and simplifies security rules based on `request.auth.uid`.\n2.  **Authorization Independence:** The `userId` field is present in every document within the subcollections, enabling direct authorization checks without needing to traverse up the hierarchy using `get()` calls. This ensures that all reads and writes can be validated independently.\n3.  **QAPs Support:** The structure supports secure `list` operations by segregating user-specific data into subcollections. Security rules can efficiently filter data based on the `userId` without exposing data from other users.\n4.  **Data Integrity:** Timestamps (if applicable) and other critical data are enforced at the rule level to maintain the integrity of the data.\n5.  **Denormalization:** While not explicitly denormalizing membership maps (since the data is user-owned), the `userId` field duplication serves as a form of denormalization, avoiding the need to fetch user documents to authorize operations on financial goals, budgets, etc.\n\nThis structure ensures that all documents within a collection share the same security requirements (Structural Segregation), further simplifying security rules and enhancing maintainability. The explicit path-based ownership model promotes clarity and debuggability, making it straightforward to understand and audit access control."
  }
}